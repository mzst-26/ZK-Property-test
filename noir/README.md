# Noir circuits

This directory is organized as a Noir workspace hosting the circuits required by the platform: enrollment, anonymous
signaling (RLN), and poll voting.  Each circuit compiles to an artifact consumed by the frontend and verified by the backend.

```
noir/
├── Nargo.toml
├── enroll/
│   ├── Nargo.toml
│   └── src/enroll.nr
├── signal/
│   ├── Nargo.toml
│   └── src/signal.nr
├── vote/
│   ├── Nargo.toml
│   └── src/vote.nr
└── vote_weighted/
    ├── Nargo.toml
    └── src/vote_weighted.nr
```

Each package compiles independently so proofs can evolve without rebuilding everything.

## Enroll circuit

- Supports two eligibility paths: Verifiable Credential (VC) and zkEmail (DKIM) invites.
- Emits a Poseidon-based member commitment and an enrollment nullifier derived from the holder secret and org identifier.
- Ensures VC issuer keys or DKIM public keys match the organization configuration exposed by the backend.

## Signal circuit

- Verifies membership inside the organization Merkle tree.
- Emits a channel-specific post nullifier and an RLN tag derived from the member secret and epoch.
- Enforces rate limits by validating the number of emissions per epoch stays below the configured quota.

## Vote circuit

- Ensures single vote per poll via a vote nullifier derived from the member secret and poll identifier.
- Outputs a Pedersen commitment (or ElGamal ciphertext) to the private vote choice for tallying.
- Companion tally circuit proves that decrypted totals equal the sum of committed votes without revealing individuals.

## Weighted vote circuit (v2)

- Adds a shareholder registry Merkle root proving each voter's maximum weight without leaking their exact weight.
- Keeps the same nullifier construction as the standard vote circuit.

## Development

```bash
# Install toolchain
noirup

# Compile a specific package
cd noir/enroll
nargo compile

# Run circuit tests
nargo test
```

Artifacts generated by `nargo compile` should be copied into `web/public/artifacts/` so the frontend prover can load the
latest constraint system.
